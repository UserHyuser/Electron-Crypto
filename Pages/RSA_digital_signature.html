<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>RSA цифровая подпись</title>
	<style>.flash_red { background-color: red; } .flash_green { background-color: limegreen; }</style>
</head>
<body>
<h1>RSA цифровая подпись</h1>
<div class="">
	<label id="labelP">P:</label>
	<input type="text" class="form-control" id="inputP" size="30">
	<label id="labelQ">Q:</label>
	<input type="text" class="form-control" id="inputQ" size="30">
	<label id="labelSize"></label>
	<input type="text" class="form-control" id="keysize" size="9" value="Размер ключа" onclick="clearInput('keysize')">
	<button onclick="generate()">Сгенерировать</button>
</div>
<br>
<div>
	<label id="">Введите сообщение </label>
	<label id="labelD">D:</label>
	<input type="text" class="form-control" id="inputD" size="30">
	<label id="labelN">N:</label>
	<input type="text" class="form-control" id="inputN" size="30">
	<br>
	<textarea cols="110" rows="5" id="message"></textarea>
	<br>
	<button onclick="encode()">Сгенерировать ЭП</button>
</div>
<br>
<div>
	<label >Введите данные для проверки ЭП </label>

	<label id="labelE">E:</label>
	<input type="text" class="form-control" id="inputE" size="30">
	<label id="labelN">N:</label>
	<input type="text" class="form-control" id="inputN2" size="30">
	<br>
	<textarea cols="110" rows="5" id="cryptMessage"></textarea>
	<br>
	<button onclick="trustifySignature()">Проверить цифровую подпись</button>
</div>

<script>
	const electron = require('electron');
	const {ipcRenderer} = electron;

	function clearInput(id) {
		document.getElementById(id).value = '';
	}

	let inputP = document.getElementById("inputP");
	let inputQ = document.getElementById("inputQ");
	let inputE = document.getElementById("inputE");
	let inputD = document.getElementById("inputD");
	let inputN = document.getElementById("inputN");
	let inputN2 = document.getElementById("inputN2");
	let keysize = document.getElementById("keysize");

	function generate() {

		// let keys = genKeys(inputP.value, inputQ.value);
		keys = bigNumbersGenerate(keysize.value, inputP.value, inputQ.value);
		inputP.value = keys.p;
		inputQ.value = keys.q;
		inputE.value = keys.e;
		inputD.value = keys.d;
		inputN.value = keys.n;
		inputN2.value = keys.n;
	}

	let out = document.getElementById('cryptMessage');
	let field = document.getElementById('message');

	/*Create a signature*/
	function encode() {

		const hash = crypto.createHash('md5').update(field.value).digest('dec');

		out.value = fastDegreeModule(BigInt(hash.join('')), inputD.value, inputN.value); // Digest
	}

	function trustifySignature() {

		const hash = crypto.createHash('md5').update(field.value).digest('dec')

		const checkedDigest = fastDegreeModule(BigInt(out.value), inputE.value, inputN.value)

		if(hash.join('') === checkedDigest.toString()) {
			field.classList.add('flash_green')
			setTimeout(function(){
				field.classList.remove('flash_green');
			}, 2000);
		} else {
			field.classList.add('flash_red');
			setTimeout(function(){
				field.classList.remove('flash_red');
			}, 2000);
		}
	}
</script>
<script src="../src/functions.js"></script>
</body>
</html>